#!/bin/bash

# --- interpreter
#$ -S /bin/sh
#
# --- run from current dir
#$ -cwd
#
# --- job name
#$ -N rexa.pstotext
#
# --- stdio redirection
#$ -e /dev/null
#$ -o /dev/null
#
# --- merge stdout/stderr?
#$ -j y
#
# --- pass on entire env
#$ -V
# need to get the actual location of bin dirs from config file (or rely on convention)
declare -r totext="../the-world/the-livingroom/pstotext/bin/totext -debug -nogzip"
run_pstotext () {
    local pdfFile="$1"
    local path=$(dirname "$pdfFile")
    local filename=$(basename "$pdfFile")
    local artifactdir="${path}/${filename}.d/pstotext"

    echo "file                   = $pdfFile"
    echo "output dir             = $artifactdir"

    mkdir -p "$artifactdir"

    $totext -file $pdfFile

    mv $pdfFile.pstotext.* "$artifactdir/"
}


# kludge: remove any pstotext tmp files that may be left in /tmp,
find /tmp -maxdepth 1 -type f -name 'ps2*'  -amin +2 -printf "removing temp file %f\n" -exec rm {} ';'

declare -a pdfs=(
  "papers/E/0/0/0/E000375F4ECCDAA5B7EF0F0AB3D976CBCA404A8A.pdf"
  "papers/E/0/0/0/E00036A66E535B303319DBEB65F849ED6D679A96.pdf"
  "papers/E/0/0/0/E00033E8E51E0794515F14B6776719621C67228E.pdf"
  "papers/E/0/0/0/E0003B58450C780F66BB55513B562D11C402A3DF.ps"
  "papers/0/E00089BDF8C192928B4D7122612511635FE7129C.pdf"
)

for pdf in ${pdfs[@]}
do
    # echo $pdf
    run_pstotext ${pdf}
done

